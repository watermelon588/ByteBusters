<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Period Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <div><h2 class="title">Period Tracker</h2><div class="muted">Predict next period & fertile window</div></div>
      <div><a class="btn btn-ghost" href="index.html">← Dashboard</a></div>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <form id="periodForm">
        <label class="label">First day of last period
          <input id="lastPeriod" type="date" required />
        </label>
        <label class="label">Average cycle length (days)
          <input id="cycleLength" type="number" min="21" max="40" value="28" required />
        </label>
        <div class="row" style="gap:10px;margin-top:12px;">
          <button class="btn" type="submit">Predict</button>
          <button id="clearBtn" class="btn btn-outline" type="button">Clear</button>
        </div>
      </form>
    </section>

    <section id="resultsPanel" class="panel" style="display:none;">
      <h3>Predictions</h3>
      <p id="nextPeriodText" class="muted"></p>
      <p id="fertileWindowText" class="muted"></p>
      <div id="calendarPreview" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:6px"></div>
    </section>
  </main>

  <a class="sos-btn" href="#" id="sosBtnPeriod" title="Emergency SOS">SOS</a>

  <script src="script.js"></script>
  <script>
    function addDays(d, days){ const r=new Date(d); r.setDate(r.getDate()+days); return r; }
    function formatDate(d){ return d.toLocaleDateString(); }

    document.getElementById('periodForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const lp = document.getElementById('lastPeriod').value;
      const cycle = parseInt(document.getElementById('cycleLength').value,10);
      if (!lp || !cycle) return;
      const last = new Date(lp);
      const next = addDays(last, cycle);
      // Fertile window approx: day 10-16 from period start for approx 28-day cycle
      const fertileStart = addDays(last, Math.max(8, Math.round(cycle/2)-3));
      const fertileEnd = addDays(last, Math.max(12, Math.round(cycle/2)+3));

      document.getElementById('nextPeriodText').innerHTML = `<strong>Next period:</strong> ${formatDate(next)}`;
      document.getElementById('fertileWindowText').innerHTML = `<strong>Estimated fertile window:</strong> ${formatDate(fertileStart)} — ${formatDate(fertileEnd)} (approx.)`;

      // preview next 35 days
      const cal = document.getElementById('calendarPreview'); cal.innerHTML='';
      const start = new Date();
      for(let i=0;i<35;i++){
        const d = addDays(start, i);
        const el = document.createElement('div');
        el.className='mini-day';
        if (d.toDateString() === next.toDateString()) el.classList.add('period');
        if (d >= fertileStart && d <= fertileEnd) el.classList.add('fertile');
        el.textContent = d.getDate();
        cal.appendChild(el);
      }
      document.getElementById('resultsPanel').style.display='block';
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      document.getElementById('lastPeriod').value = '';
      document.getElementById('cycleLength').value = 28;
      document.getElementById('resultsPanel').style.display = 'none';
    });
  </script>
</body>
</html>
